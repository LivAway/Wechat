webpackJsonp([5],{jawP:function(e,t,a){"use strict";var n=a("6l/8"),i=a.n(n),s=a("IDPl"),l=a.n(s),o=a("cYhT"),c=a.n(o),r=a("bMv6"),m=a.n(r),d=a("Y+8b"),u=a.n(d),f=a("kLfz"),p=a.n(f),h=a("mG+w"),v=a.n(h),_=a("jGwe"),y=a("fiaM"),g=a("aSYM"),E=a("nVDU"),b=a("Ue9x"),k=v.a.createElement("i",{className:"iconfont icon-goback"}),w=v.a.createElement("span",null,"Back"),N=v.a.createElement("div",{className:"mid_title"},"Write a Review"),x=v.a.createElement("a",{className:"right_link"}),C=v.a.createElement("button",{type:"submit",className:"send_btn send_ok_btn btn_send"},"DONE"),j=v.a.createElement("button",{type:"submit",disabled:!0,className:"send_btn "},"DONE"),S=function(e){function t(e){var a;return l()(this,t),a=u()(this,p()(t).call(this,e)),a.send=function(e,t,n,i){var s=a.state;s.list,s.last_date;Object(E.a)(g.a,{content:e,to_uid:t,meet_id:n,knp:i}).then(function(e){Object(y.a)(e)?window.layer.open({content:"Comment on success",btn:"I got it!",shadeClose:!1,yes:function(e){window.layer.close(e),a.props.cancelReview()}}):(alert(e.msg),e.knp&&a.setState({user_knp:e.knp}))})},a.load=function(){Object(E.a)(g.c).then(function(e){Object(y.a)(e)&&a.setState({user_knp:e.data})})},a.keyDownSearch=function(e){var t=e||window.event;return 13!=(t.keyCode||t.which||t.charCode)||(a.sendMsg(),!1)},a.changeContent=function(e){a.setState({content:e.target.value})},a.sendMsg=function(e){e.preventDefault();var t=a.state,n=t.content,i=t.knp,s=t.user_knp,l=a.props,o=l.item,c=l.meet_id,r=parseInt(i);if(r>0){if(r>s)return void(0==s?alert("No available KNP please set to 0"):alert("Total KNP You Have: "+s+" KNP"))}else if(0!=r)return void alert("KNP must be greater than or equal to 0.\n");a.send(n,o.to_uid,c,r)},a.changeKnp=function(e){a.setState({knp:e.target.value})},a.state={content:"",knp:"",user_knp:0},a}return m()(t,[{key:"componentWillMount",value:function(){this.load()}},{key:"render",value:function(){var e=this,t=(this.props.visible,this.state),a=t.content,n=t.knp,i=t.user_knp,s=a.replace(/(^\s*)|(\s*$)/g,"");return v.a.createElement(_.Content,{style:{zIndex:99}},v.a.createElement(_.Popup,{direction:"right",visible:!0},v.a.createElement("div",{className:"layui-m-layerchild "},v.a.createElement("div",{className:"mod_center",style:{position:"fixed",left:"0px",bottom:"0px",left:"0px",top:"0px",right:"0px",display:"table"}},v.a.createElement("div",{className:"mod_header","data-flex":"dir:left cross:center main:justify"},v.a.createElement("a",{className:"left_link",href:"javascript:void(0)",onClick:this.props.cancelReview},k,w),N,x),v.a.createElement("div",{className:"message_content message_content_preview"},v.a.createElement("div",{className:"message_panel"},v.a.createElement("form",{"data-flex":"dir:top cross:center",style:{width:"100%"},onSubmit:function(t){return e.sendMsg(t)}},v.a.createElement("div",{"data-flex":"dir:left",style:{width:"100%"}},v.a.createElement("label",null,"KNP ",v.a.createElement("span",{style:{color:"red"}},"*"))),v.a.createElement("input",{placeholder:"Total KNP You Have: ".concat(i," KNP"),value:n,onChange:this.changeKnp,className:"input_content",style:{width:"100%"}}),v.a.createElement("div",{"data-flex":"dir:left",style:{width:"100%"}},v.a.createElement("label",null,"Review ",v.a.createElement("span",{style:{color:"red"}},"*"))),v.a.createElement("textarea",{value:a,onChange:this.changeContent}),s.length>0?C:j)))))))}}]),c()(t,e),t}(h.PureComponent),R=a("kY3M");a.d(t,"a",function(){return D});var M=v.a.createElement("i",{className:"iconfont icon-goback"}),I=v.a.createElement("span",null,"Back"),O=v.a.createElement("div",{className:"layim-chat-text"}),P=v.a.createElement("button",{type:"submit",className:"btn btn_send"},"Send"),q=v.a.createElement("button",{type:"submit",disabled:!0,className:"btn"},"Send"),D=function(e){function t(e){var a;return l()(this,t),a=u()(this,p()(t).call(this,e)),a.sendMsg=function(e){return e.preventDefault(),a.timer2&&window.clearTimeout(a.timer2),a.timer2=window.setTimeout(function(){var e=a.state.content,t=e.replace(/(^\s*)|(\s*$)/g,"");if(t){var n=a.props.item;a.send(t,n.to_uid)}},200),!1},a.load=function(e,t,n){var i=a.state,s=i.not_id,l=i.list,o=i.first_id,c=a.props.item;Object(E.a)(g.g,{to_id:c.to_uid,last_date:e,is_history:t,last_id:n,not_id:s}).then(function(e){Object(y.a)(e)&&(1==t?a.setState({is_history:e.data.is_history,first_id:e.data.first_id,first_date:e.data.first_date,list:e.data.list.concat(l),request_count:e.data.count,meet:e.data.meet}):(Object(y.b)(o)?a.setState({is_history:e.data.is_history,last_date:e.data.last_date,last_id:e.data.last_id,list:l.concat(e.data.list),meet:e.data.meet}):a.setState({is_history:e.data.is_history,first_id:e.data.first_id,first_date:e.data.first_date,last_date:e.data.last_date,last_id:e.data.last_id,list:l.concat(e.data.list),request_count:e.data.count,meet:e.data.meet}),e.data.list&&e.data.list.length>0&&(a.dom2.style.display="none",a.scrollDom())))})},a.scrollDom=function(){setTimeout(function(){a.dom&&(a.dom.scrollTop=a.dom.scrollHeight)})},a.send=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=a.state,s=(i.list,i.last_date,a.props.group);Object(E.a)(g.h,{content:e,to_uid:t,msg_type:n,group:s}).then(function(t){Object(y.a)(t)&&(a.setState({content:"",is_meet:1==n?1:0}),a.dom2.children[1].innerHTML=e,a.dom2.removeAttribute("style"),a.scrollDom())})},a.keyDownSearch=function(e){var t=e||window.event;return 13!=(t.keyCode||t.which||t.charCode)||(a.sendMsg(),!1)},a.changeContent=function(e){a.setState({content:e.target.value})},a.showMsg=function(){var e=a.state.list,t=[];return e&&e.length>0&&e.map(function(e,n){10==e.msg_type?t.push(v.a.createElement("li",{key:n,className:"layim-chat-system"},v.a.createElement("span",null,e.msg))):0==e.msg_type?1==e.is_self?t.push(v.a.createElement("li",{key:n,className:"layim-chat-li"},v.a.createElement("div",{className:"layim-chat-user"},v.a.createElement("img",{src:e.from_headpic}),v.a.createElement("cite",null,e.from_nickname)),v.a.createElement("div",{className:"layim-chat-text"},e.msg))):t.push(v.a.createElement("li",{key:n,className:"layim-chat-li layim-chat-mine"},v.a.createElement("div",{className:"layim-chat-user"},v.a.createElement("img",{onClick:function(){return a.showUserInfo(e.from_uid)},src:e.from_headpic}),v.a.createElement("cite",null,e.from_nickname)),v.a.createElement("div",{className:"layim-chat-text"},e.msg))):1==e.msg_type&&t.push(v.a.createElement("li",{key:n,className:"layim-chat-system"},v.a.createElement("div",{"data-felx":"dir:top cross:center main:center"},v.a.createElement("font",{style:{fontSize:"16px",borderRadius:"3px",background:"#afafaf",color:"#fff",padding:"1px",marginBottom:"5px"}},"System"),v.a.createElement("div",{style:{marginTop:"10px"},"data-flex":"cross:center main:center"},v.a.createElement("span",{style:{backgroundColor:"#afafaf",lineHeight:"20px"}},Object(y.c)(e.msg))))))}),t},a.showHistory=function(){var e=a.state,t=e.first_date,n=e.first_id;a.load(t,1,n)},a.getRef=function(e){a.dom=e},a.getRef2=function(e){a.dom2=e},a.autoLoad=function(e,t){if(Object(y.b)(a.timer)&&a.timer&&window.clearInterval(a.timer),1==e){var n=t;a.timer=window.setInterval(function(){0==n?(n=t,a.load(a.state.last_date,0,a.state.last_id)):n--},1e3)}},a.RequestMeet=function(){a.send("You have requested a meet up. Please wait for reply.",a.props.item.to_uid,1)},a.agreeMeet=function(){var e=a.state;e.list,e.last_date;Object(E.a)(g.d,{meet_id:a.state.meet.oid,to_id:a.props.item.to_uid}).then(function(e){Object(y.a)(e)})},a.RequestReview=function(){a.state.visible;a.setState({visible:!0})},a.cancelReview=function(){a.state.visible;a.setState({visible:!1})},a.showUserInfo=function(e){a.setState({visible_user:!0,view_user_id:e})},a.getInputRef=function(e){a.msg_panel=e},a.clickInput=function(e){},a.state={content:"",list:[],last_id:"",not_id:"",request_count:0,first_date:"",first_id:"",is_meet:0,meet:{},visible:!1,visible_user:!1,view_user_id:0},a.dom="",a.dom2="",a.timer="",a.msg_panel="",a.timer2="",a}return m()(t,[{key:"componentWillMount",value:function(){var e=this;this.load(void 0,void 0,void 0),setTimeout(function(){e.autoLoad(!0,1)},1e3)}},{key:"componentWillUnmount",value:function(){Object(y.b)(this.timer)&&this.timer&&window.clearInterval(this.timer)}},{key:"componentDidMount",value:function(){this.msg_panel.focus(),this.dom.scrollTop=1e5}},{key:"render",value:function(){var e=this,t=this.props,a=t.item,n=t.onCancel,s=this.state,l=s.content,o=s.request_count,c=s.is_meet,r=s.meet,m=s.visible,d=s.visible_user,u=s.view_user_id,f=l.replace(/(^\s*)|(\s*$)/g,"");return v.a.createElement(_.Content,null,v.a.createElement(_.Popup,{visible:!0},v.a.createElement("div",{className:"layui-m-layerchild "},v.a.createElement("div",{className:"mod_center",style:{position:"fixed",left:"0px",bottom:"0px",left:"0px",top:"0px",right:"0px",display:"table"}},v.a.createElement("div",{className:"mod_header","data-flex":"dir:left cross:center main:justify"},v.a.createElement("a",{className:"left_link",onClick:n,href:"javascript:void(0)"},M,I),v.a.createElement("div",{className:"mid_title"},a.nickname)),0==c&&0==i()(r).length&&v.a.createElement("div",{className:"send_top_tips",style:{zIndex:"999",position:"relative",background:"#fff"}},"You can request a meet up with him/her ",v.a.createElement("a",{onClick:this.RequestMeet,href:"javascript:void(0)"},"Request")),1==c&&(0==i()(r).length||0==r.status)&&1==r.is_self||1==r.is_self&&0==r.status&&v.a.createElement("div",{className:"send_top_tips",style:{zIndex:"999",position:"relative",background:"#fff"}},"You have requested a meet up. Please wait for reply."),i()(r).length>0&&1==r.status&&0==r.is_comment&&v.a.createElement("div",{className:"send_top_tips",style:{zIndex:"999",position:"relative",background:"#fff"}},"How do you think of her/him after meet? ",v.a.createElement("a",{onClick:this.RequestReview,href:"javascript:void(0)"},"Review")),i()(r).length>0&&1==r.status&&1==r.is_comment&&r.last_comment_uid!=b.a.uid&&v.a.createElement("div",{className:"send_top_tips",style:{zIndex:"999",position:"relative",background:"#fff"}},"How do you think of her/him after meet? ",v.a.createElement("a",{onClick:this.RequestReview,href:"javascript:void(0)"},"Review")),i()(r).length>0&&0==r.status&&0==r.is_comment&&0==r.is_self&&v.a.createElement("div",{className:"send_top_tips",style:{zIndex:"999",position:"relative",background:"#fff"}},v.a.createElement("span",{style:{color:"#2196f3"}},r.nickname)," has requested a meet up. ",v.a.createElement("a",{onClick:this.agreeMeet,href:"javascript:void(0)"},"AGREE")),v.a.createElement("div",{className:"message_content",style:{background:"#eee"}},v.a.createElement("div",{ref:this.getRef,className:"message_panel layim-chat-main"},v.a.createElement("ul",{style:{marginTop:"20px"}},5==o&&v.a.createElement("li",{className:"layim-chat-system"},v.a.createElement("span",{onClick:this.showHistory,style:{background:"#47a8f5"}},"Click to load more")),this.showMsg(),v.a.createElement("li",{style:{display:"none"},ref:this.getRef2,className:"layim-chat-li"},v.a.createElement("div",{className:"layim-chat-user"},v.a.createElement("img",{src:b.a.headpic}),v.a.createElement("cite",null,b.a.nickname)),O)))),v.a.createElement("div",{"data-flex":"dir:left box:last cross:center",className:"footer_send_content footer_send_content1"},v.a.createElement("form",{"data-flex":"dir:left box:last cross:center",style:{width:"100%"},onSubmit:function(t){return e.sendMsg(t)}},v.a.createElement("input",{"for-scroll":"122112",ref:this.getInputRef,value:l,onChange:this.changeContent,type:"text"}),f.length>0?P:q)))),m&&v.a.createElement(S,{meet_id:r.oid,cancelReview:this.cancelReview,style:{zIndex:99},item:this.props.item,visible:m}),d&&v.a.createElement(R.a,{cancelReview:function(){e.setState({visible_user:!1})},uid:u})))}}]),c()(t,e),t}(h.PureComponent)},qVHm:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a.d(t,"default",function(){return w});var n=a("IDPl"),i=a.n(n),s=a("cYhT"),l=a.n(s),o=a("bMv6"),c=a.n(o),r=a("Y+8b"),m=a.n(r),d=a("kLfz"),u=a.n(d),f=a("mG+w"),p=a.n(f),h=(a("Ue9x"),a("fiaM")),v=a("nVDU"),_=a("aSYM"),y=a("EkNY"),g=a("jawP"),E=a("/yVg"),b=a.n(E),k=p.a.createElement("div",{className:"mod_header","data-flex":"dir:left cross:center main:justify"},p.a.createElement(b.a,{className:"left_link",to:"/"},p.a.createElement("i",{className:"iconfont icon-goback"}),p.a.createElement("span",null,"Back")),p.a.createElement("div",{className:"mid_title"})),w=function(e){function t(e){var a;return i()(this,t),a=m()(this,u()(t).call(this,e)),a.autoLoad=function(e,t){if(Object(h.b)(a.timer)&&a.timer&&window.clearInterval(a.timer),1==e){var n=t;a.timer=window.setInterval(function(){0==n?(n=t,a.load()):n--},1e3)}},a.load=function(){a.state.list;a.setState({loading:!0,msg:"Loading"}),Object(v.a)(_.i).then(function(e){Object(h.a)(e)&&(0==e.data.length&&Object(h.b)(a.timer)&&a.timer&&window.clearInterval(a.timer),a.setState({list:e.data,loading:!1,msg:0==e.data.length?"No unread messages for the time being":"",load_count:e.data.length}))})},a.onCancel=function(){a.setState({visible:!1})},a.see=function(e){a.setState({visible:!0,send_item:{to_uid:e.from_uid,nickname:e.from_nickname,headpic:e.from_headpic}})},a.loadData=function(){var e=a.state.list,t=[];return e.map(function(e,n){t.push(p.a.createElement("li",{key:n,onClick:function(){a.see(e)},"layim-event":"chat","data-type":"history","data-index":"friend100001",className:"layim-friend100001 "},p.a.createElement("div",null,p.a.createElement("img",{src:e.from_headpic})),p.a.createElement("span",null,e.from_nickname),p.a.createElement("p",null,e.msg),e.count>0&&p.a.createElement("span",{className:"layim-msg-status layui-show"},e.count)))}),t},a.state={list:[],loading:!1,load_count:0,msg:"",visible:!1,send_item:{}},a.timer="",a}return c()(t,[{key:"componentWillMount",value:function(){document.title=window.title+" -  Messages",this.load(),this.autoLoad(!0,2)}},{key:"componentWillUnmount",value:function(){Object(h.b)(this.timer)&&this.timer&&window.clearInterval(this.timer)}},{key:"render",value:function(){var e=this,t=this.state,a=t.list,n=t.loading,i=t.msg,s=t.send_item,l=t.load_count,o=t.visible,c=p.a.createElement("i",{style:{fontSize:"50px"},className:"iconfont icon-wuxiaoxi"});return p.a.createElement("div",{className:"layui-m-layerchild "},p.a.createElement("div",{className:"mod_center",style:{position:"fixed",left:"0px",bottom:"0px",left:"0px",top:"0px",right:"0px",display:"table"}},k,p.a.createElement("div",{className:"message_content message_content_message"},p.a.createElement("div",{className:"message_panel layim-tab-content layui-show"},0==a.length&&0==l?p.a.createElement(y.a,{icon:c,requestData:function(){e.load(),e.autoLoad(!0,2)},loading:n,msg:i}):p.a.createElement("ul",{className:"layui-layim-list layui-show layim-list-history"},this.loadData())))),o&&p.a.createElement(g.a,{group:0,onCancel:this.onCancel,visible:o,item:s}))}}]),l()(t,e),t}(f.PureComponent)}});